Here are **detailed notes** on **Jenkins Pipeline Concepts**, including `agent`, `stage`, `steps`, `environment`, and other advanced constructs like `input`, `when`, `post`, `options`, `parameters`, `shared libraries`, `parallel`, `retry`, and `timeout`.

---

## üîß 11. Jenkins Pipeline Concepts ‚Äì Detailed Notes

---

### üöÄ What is a Jenkins Pipeline?

A **Pipeline** is a suite of **automated processes** that allows you to define your **build, test, and deploy** steps in a script, versioned in source control.

* Written in **Groovy-based DSL (Domain Specific Language)**
* Pipeline file is usually named `Jenkinsfile`

---

## üß± Basic Building Blocks

### 1. `pipeline {}` ‚Äì The Declaration Block

Wraps the entire pipeline definition using Declarative Syntax.

---

### 2. `agent`

Defines **where** the pipeline or a stage should run.

```groovy
pipeline {
  agent any   // Run on any available agent
}
```

‚úÖ Other agent types:

* `none` ‚Äì You must specify an agent at the stage level.
* `label 'linux'` ‚Äì Specific agent node.
* `docker { image 'node:14' }` ‚Äì Run in Docker container.

---

### 3. `stages`

Groups a sequence of steps into named stages.

```groovy
stages {
  stage('Build') {
    steps {
      echo 'Building...'
    }
  }
}
```

---

### 4. `steps`

Actual commands or build instructions to run.

```groovy
steps {
  sh 'npm install'
  sh 'npm test'
}
```

For Windows:

```groovy
steps {
  bat 'dir'
}
```

---

### 5. `environment`

Define **environment variables** available within the pipeline.

```groovy
environment {
  NODE_ENV = 'production'
  PATH = "${env.PATH}:/custom/path"
}
```

---

## üß† Advanced Concepts

---

### 6. `input`

Used to pause the pipeline and ask for manual approval.

```groovy
stage('Deploy') {
  steps {
    input "Proceed with deployment?"
    sh './deploy.sh'
  }
}
```

---

### 7. `when`

Used for **conditional execution** of stages.

```groovy
stage('Deploy to Prod') {
  when {
    branch 'main'
  }
  steps {
    sh './deploy_prod.sh'
  }
}
```

Other conditions:

* `expression { return env.BUILD_NUMBER == '10' }`
* `not { branch 'dev' }`
* `beforeAgent true` ‚Äì Evaluate before allocating agent.

---

### 8. `post`

Defines actions after the pipeline or a stage finishes.

```groovy
post {
  success {
    echo 'Pipeline succeeded!'
  }
  failure {
    echo 'Pipeline failed.'
  }
  always {
    echo 'This runs always.'
  }
}
```

---

### 9. `options`

Pipeline-level options like timeouts, retries, concurrency control.

```groovy
options {
  timeout(time: 30, unit: 'MINUTES')
  retry(2)
  skipDefaultCheckout(true)
}
```

---

### 10. `parameters`

Defines input parameters for the pipeline.

```groovy
parameters {
  string(name: 'ENV', defaultValue: 'dev', description: 'Environment')
  booleanParam(name: 'RUN_TESTS', defaultValue: true, description: 'Run tests?')
  choice(name: 'BRANCH', choices: ['dev', 'main'], description: 'Git Branch')
}
```

Use it like:

```groovy
echo "Deploying to ${params.ENV}"
```

---

### 11. Shared Libraries

Reusable functions and logic stored in a **central Git repo**.

* Great for large teams
* Located in `$JENKINS_HOME/shared-libraries`

```groovy
@Library('my-shared-lib') _
import com.mycompany.MyUtils

MyUtils.sayHello()
```

üõ†Ô∏è Structure:

```
vars/
  myFunction.groovy
src/
  com/mycompany/MyUtils.groovy
```

---

### 12. Parallel Stages

Run multiple stages in parallel to save time.

```groovy
stage('Parallel Tests') {
  parallel {
    stage('Unit Tests') {
      steps { sh 'npm run unit' }
    }
    stage('Integration Tests') {
      steps { sh 'npm run integration' }
    }
  }
}
```

---

### 13. `retry`

Retries a block of steps on failure.

```groovy
retry(3) {
  sh './unstable_command.sh'
}
```

---

### 14. `timeout`

Enforces a timeout for a block of steps or stage.

```groovy
timeout(time: 5, unit: 'MINUTES') {
  sh './slow_script.sh'
}
```

---

### ‚úÖ Sample Full Jenkinsfile

```groovy
pipeline {
  agent any

  parameters {
    string(name: 'ENV', defaultValue: 'dev', description: 'Environment to deploy')
  }

  environment {
    DEPLOY_ENV = "${params.ENV}"
  }

  stages {
    stage('Build') {
      steps {
        echo "Building app for ${env.DEPLOY_ENV}"
        sh 'npm install'
      }
    }

    stage('Test') {
      parallel {
        stage('Unit Test') {
          steps {
            sh 'npm run test:unit'
          }
        }
        stage('Integration Test') {
          steps {
            sh 'npm run test:integration'
          }
        }
      }
    }

    stage('Approval') {
      steps {
        input "Deploy to ${params.ENV}?"
      }
    }

    stage('Deploy') {
      steps {
        timeout(time: 10, unit: 'MINUTES') {
          sh "./deploy.sh ${params.ENV}"
        }
      }
    }
  }

  post {
    success {
      echo '‚úÖ Deployment successful!'
    }
    failure {
      echo '‚ùå Deployment failed!'
    }
  }
}
```

---

Let me know when you're ready for:

* üí¨ Interview Questions + Answers
* üìò Scenario-Based Questions + Solutions

I'll prepare both!
